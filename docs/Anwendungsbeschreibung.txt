# Anwendungsbeschreibung: Nodal Staging Analysis Tool (Version 3.1.0)

## 1. Einleitung

### 1.1. Zweck und Geltungsbereich
Das **Nodal Staging: Avocado Sign vs. T2 Criteria** Analysis Tool ist eine client-seitige Webanwendung, die speziell für die **wissenschaftliche Forschung** in der radiologischen Diagnostik des Rektumkarzinoms entwickelt wurde. Es bietet eine interaktive Plattform zur umfassenden Analyse und zum Vergleich der diagnostischen Güte verschiedener MRT-basierter Kriterien für die Beurteilung des mesorektalen Lymphknotenstatus (N-Status).

Der Fokus der Anwendung liegt auf der Evaluation des innovativen "Avocado Sign" (AS) im direkten Vergleich mit:
* Etablierten, literaturbasierten T2-gewichteten (T2w) morphologischen Kriterien.
* Datengetriebenen, kohorten-optimierten T2w-Kriterien, die mithilfe einer Brute-Force-Analyse auf dem vorliegenden Datensatz ermittelt werden.

Die Anwendung unterstützt den gesamten Forschungsprozess, von der Datenexploration über detaillierte statistische Analysen bis hin zur Erstellung von Manuskriptentwürfen, die den Publikationsanforderungen medizinisch-radiologischer Fachjournale entsprechen.

### 1.2. Kernfunktionalitäten
* **Interaktive Datenexploration:** Visualisierung und Sortierung eines pseudonymisierten Patientendatensatzes mit detaillierter Ansicht individueller Lymphknotenmerkmale.
* **Flexible Kriteriendefinition:** Dynamische Definition und Anwendung komplexer T2w-Malignitätskriterien, inklusive logischer Verknüpfungen (AND/OR).
* **Automatisierte Kriterien-Optimierung:** Eine integrierte Brute-Force-Analyse identifiziert mathematisch optimale T2w-Kriterienkombinationen für eine gewählte Patientenkohorte basierend auf einer definierbaren Zielmetrik.
* **Umfassende statistische Analyse:** Berechnung und Darstellung aller relevanten Metriken zur diagnostischen Güte (Sensitivität, Spezifität, positiver/negativer prädiktiver Wert (PPV/NPV), Genauigkeit, Area Under the Curve (AUC)), inklusive 95%-Konfidenzintervallen und statistischer Vergleichstests (z.B. DeLong, McNemar).
* **Publikations-Assistent:** Generierung von formatierten Texten, Tabellen und Abbildungen für ein wissenschaftliches Manuskript, unter Einhaltung spezifischer Stilrichtlinien (z.B. des Fachjournals *Radiology*).
* **Vielseitiger Datenexport:** Export von Rohdaten, Analyseergebnissen, Tabellen, Grafiken und Publikationstexten in diversen Formaten (CSV, Markdown (MD), Text (TXT), PNG, SVG, HTML).

### 1.3. Wichtiger Hinweis: Forschungsinstrument
**Disclaimer:** Diese Anwendung ist ausschließlich für **Forschungs- und Bildungszwecke** konzipiert. Die dargestellten Daten, Statistiken und generierten Texte basieren auf einem statischen, pseudonymisierten Forschungsdatensatz. **Die Ergebnisse dürfen nicht für die klinische Diagnostik, direkte Behandlungsentscheidungen oder andere primäre medizinische Anwendungen herangezogen werden.** Die wissenschaftliche und klinische Verantwortung für die Interpretation und Verwendung der generierten Ergebnisse liegt allein beim Nutzer.

## 2. Globale Konzepte und Bedienung

Die Benutzeroberfläche ist darauf ausgelegt, einen intuitiven und effizienten wissenschaftlichen Arbeitsablauf zu unterstützen.

### 2.1. Anwendungs-Layout
* **Header:** Ein feststehender Kopfbereich der Anwendung enthält den Anwendungstitel, die globale Kohortenauswahl sowie dynamische Meta-Statistiken zur aktuell gewählten Datenbasis.
* **Navigationsleiste (Tabs):** Eine horizontale Reiter-Navigation ermöglicht den schnellen Wechsel zwischen den sechs Hauptmodulen (Tabs) der Anwendung.
* **Inhaltsbereich:** Der zentrale Arbeitsbereich, in dem die spezifischen Inhalte und Tools des jeweils aktiven Tabs dargestellt werden.

### 2.2. Globale Kohortenauswahl
Die globale Kohortenauswahl ist ein zentrales Bedienkonzept. Drei Buttons im Header filtern den gesamten Datensatz für alle nachfolgenden Analysen und Darstellungen in der Anwendung:
* **Overall:** Enthält alle 106 Patienten des pseudonymisierten Datensatzes.
* **Surgery alone:** Filtert die Patienten, die primär chirurgisch behandelt wurden (ohne vorherige neoadjuvante Therapie).
* **Neoadjuvant therapy:** Filtert die Patienten, die eine neoadjuvante Radiochemotherapie erhalten haben.

**Diese Auswahl ist global** und wirkt sich unmittelbar auf alle angezeigten Daten, Tabellen, Grafiken und statistischen Berechnungen in allen Tabs aus.

### 2.3. Dynamische Header-Statistiken
Ein Bereich im Header zeigt eine Live-Zusammenfassung der statistischen Kennzahlen der aktuell aktiven Kohorte:
* **Cohort:** Zeigt den Namen der aktuell ausgewählten Kohorte an.
* **Patients:** Zeigt die Gesamtzahl der Patienten in der aktiven Kohorte.
* **N-Status, AS-Status, T2-Status:** Zeigen jeweils den prozentualen Anteil der positiven Patienten für den pathologischen N-Status (Referenzstandard), das Avocado Sign und die aktuell angewandten T2-Kriterien an. Bei nicht definierter oder unzureichender Datenbasis wird ein Platzhalter (`--`) angezeigt.

### 2.4. Interaktive Hilfe
* **Tooltips:** Fast alle UI-Elemente sind mit detaillierten Tooltips versehen. Diese werden bei Mouse-Over angezeigt und erklären die Funktion des Elements oder die Definition einer dargestellten Metrik.
* **Quick Guide:** Ein `?`-Button im Header öffnet ein Modalfenster mit einer umfassenden Kurzanleitung. Diese erläutert alle Hauptfunktionen, Konzepte und den Aufbau der Anwendung im Detail und dient als schnelle Referenz.

## 3. Die Anwendungsmodule im Detail (Tabs)

Die Anwendung ist in sechs Hauptmodule unterteilt, die über die Navigationsleiste zugänglich sind. Jedes Modul dient einem spezifischen Zweck im Analyse- und Publikationsprozess.

### 3.1. Data Tab
* **Zweck:** Dient der Darstellung und grundlegenden Exploration des zugrundeliegenden Patientendatensatzes.
* **Komponenten & Workflow:**
    * **Patiententabelle:** Eine interaktive, sortierbare Tabelle listet alle Patienten der aktuell gewählten Kohorte auf.
        * **Sortierung:** Durch Klicken auf die Spaltenköpfe kann die Tabelle nach der jeweiligen Spalte sortiert werden (aufsteigend/absteigend).
        * **Sub-Sorting (N/AS/T2-Spalte):** Die Spalte "N/AS/T2" bietet ein spezielles Sub-Sorting. Durch Klicken auf die Labels "N", "AS" oder "T2" im Spaltenkopf kann die Tabelle zusätzlich nach dem Status dieser spezifischen Marker sortiert werden.
    * **Detailansicht (Lymphknoten):** Zeilen von Patienten, für die T2-Lymphknotendaten vorhanden sind, können durch Klicken auf die Zeile oder das Pfeil-Icon am Zeilenende erweitert werden. Die erweiterte Ansicht zeigt eine Liste der individuellen T2-Lymphknoten des Patienten mit deren morphologischen Eigenschaften (Größe, Form, Kontur, Binnensignal, Signalintensität).
    * **"Expand/Collapse All Details"-Button:** Ein Button über der Tabelle ermöglicht es, die Detailansicht der Lymphknoten für alle Patienten in der Tabelle gleichzeitig ein- oder auszublenden.

### 3.2. Analysis Tab
* **Zweck:** Ermöglicht die interaktive Definition von T2-Malignitätskriterien, die Durchführung von Optimierungsanalysen und die detaillierte Untersuchung der Auswirkungen dieser Kriterien auf Patientenebene.
* **Komponenten & Workflow:**
    * **Dashboard:** Eine Reihe von kleinen Diagrammen bietet eine grafische Übersicht über die Verteilung von Alter, Geschlecht, Therapie sowie den N-, AS- und T2-Status in der aktuellen Kohorte. Jeder Chart kann als PNG oder SVG heruntergeladen werden.
    * **"Define T2 Malignancy Criteria"-Karte:** Das interaktive Herzstück dieses Tabs.
        * **Kriterien-Aktivierung & Konfiguration:** Jedes T2-Merkmal (Größe, Form, Kontur, Homogenität, Signalintensität) kann über eine Checkbox aktiviert oder deaktiviert werden. Die Schwellenwerte für die Größe (z.B. "≥ 5.0 mm") werden über einen Slider oder manuelle Eingabe eingestellt. Für kategorische Merkmale (Form, Kontur etc.) werden die Kriterien über Buttons ausgewählt.
        * **Logik-Schalter:** Ein Schalter wechselt die logische Verknüpfung der aktiven Kriterien zwischen **AND** (ein Lymphknoten gilt nur dann als positiv, wenn *alle* aktiven Kriterien erfüllt sind) und **OR** (ein Lymphknoten gilt als positiv, wenn *mindestens eines* der aktiven Kriterien erfüllt ist).
        * **Indikator für ungespeicherte Änderungen:** Der Rahmen der Karte wird mit einem Warnsignal (orange, gestrichelt) markiert, wenn Änderungen an den Kriterien oder der Logik vorgenommen, aber noch nicht angewendet wurden.
        * **"Apply & Save"-Button:** Übernimmt die aktuell konfigurierten T2-Kriterien und die Logik in die gesamte Anwendung. Dies aktualisiert alle T2-Status-Angaben in Tabellen und Statistiken und speichert diese Einstellung dauerhaft für zukünftige Sitzungen im Browser.
        * **"Reset to Default"-Button:** Setzt alle T2-Kriterien und die Logik auf die werkseitigen Standardeinstellungen zurück.
    * **"Diagnostic Performance (Applied T2)"-Karte:** Diese Tabelle aktualisiert sich automatisch, sobald neue T2-Kriterien angewendet werden und zeigt die diagnostische Güte der aktuellen T2-Einstellung.
    * **"Criteria Optimization (Brute-Force)"-Karte:** Ein leistungsstarkes Werkzeug zur automatisierten Suche nach den optimalen T2-Kriterienkombinationen.
        * **Workflow:** Der Nutzer wählt eine Zielmetrik (z.B. "Balanced Accuracy") und startet die Analyse mit "Start". Ein Web Worker führt die Tests im Hintergrund aus.
        * **Live-Feedback:** Ein Fortschrittsbalken und das aktuell beste Ergebnis werden in Echtzeit angezeigt.
        * **Ergebnisse:** Nach Abschluss werden die optimalen Kriterien angezeigt und können mit "Apply Best Criteria" übernommen werden. Der "Top 10"-Button öffnet ein Modal mit den besten Ergebnissen.
    * **Analyse-Tabelle:** Zeigt für jeden Patienten den N-, AS- und T2-Status. Erweiterbare Zeilen visualisieren, wie jeder T2-Lymphknoten gegen die *aktuell angewandten* Kriterien evaluiert wurde.

### 3.3. Statistics Tab
* **Zweck:** Bietet eine umfassende und formale statistische Auswertung der diagnostischen Leistung des Avocado Signs und der T2-Kriterien.
* **Komponenten & Workflow:**
    * **Ansicht-Umschalter ("Single View" / "Comparison Active"):** Ermöglicht den Wechsel zwischen der Analyse einer einzelnen Kohorte und dem direkten Vergleich zweier wählbarer Kohorten.
    * **Statistik-Karten:** Eine Reihe von Informationskarten präsentiert verschiedene statistische Ergebnisse:
        * **Descriptive Statistics:** Zusammenfassung der Patientendemografie und Statusverteilungen.
        * **Diagnostic Performance (AS vs. N / T2 vs. N):** Zeigt die diagnostische Güte des Avocado Signs bzw. der angewandten T2-Kriterien.
        * **Statistical Comparison (AS vs. T2):** Führt statistische Tests (McNemar, DeLong) zum direkten Vergleich der beiden Methoden durch.
        * **Association with N-Status:** Analysiert die Assoziation einzelner Merkmale mit dem N-Status.
        * **Cohort Comparison (nur "Comparison Active"):** Vergleicht die AUC-Werte zwischen den beiden gewählten Kohorten.
        * **Criteria Comparison (nur "Single View"):** Eine zentrale Tabelle vergleicht die Performance des Avocado Signs, der angewandten T2-Kriterien und vordefinierter Kriteriensätze aus der Literatur.

### 3.4. Comparison Tab
* **Zweck:** Formatiert ausgewählte Analyseergebnisse speziell für wissenschaftliche Präsentationen und direkte visuelle Vergleiche.
* **Komponenten & Workflow:**
    * **Ansicht-Auswahl ("AS Performance" / "AS vs. T2 Comparison"):** Ermöglicht den Fokus entweder auf die alleinige Performance des AS oder auf den direkten Vergleich mit T2-Kriterien.
    * **T2-Vergleichsbasis-Auswahl:** Im "AS vs. T2"-Modus kann der Nutzer aus einem Dropdown-Menü wählen, womit das Avocado Sign verglichen werden soll: den selbst definierten Kriterien oder einem der vordefinierten Literatur-Kriteriensets.
    * **Dynamische Inhalte:** Die Ansicht generiert dynamisch Vergleichstabellen, statistische Tests und ein Balkendiagramm, das die Kernmetriken von AS und dem gewählten T2-Kriterium gegenüberstellt.
    * **Download-Funktionen:** Alle angezeigten Tabellen und Diagramme können individuell als CSV, Markdown (MD), PNG oder SVG heruntergeladen werden.

### 3.5. Publication Tab
* **Zweck:** Unterstützt den Nutzer bei der Erstellung eines wissenschaftlichen Manuskripts, insbesondere für das Fachjournal *Radiology*.
* **Komponenten & Workflow:**
    * **Sektions-Navigation:** Eine Seitenleiste ermöglicht die Navigation durch die Standardabschnitte eines Papers (Abstract, Introduction, Methods, Results, Discussion, References).
    * **Dynamische Textgenerierung:** Die Anwendung generiert für jeden Abschnitt professionell formulierte, englischsprachige Texte. Diese integrieren dynamisch die **aktuellsten Analyseergebnisse** und formatieren diese gemäß den journalistischen Vorgaben (z.B. *P* < .001).
    * **Eingebettete Inhalte:** Tabellen und Abbildungs-Platzhalter werden direkt im Textfluss generiert, um die Manuskriptstruktur zu visualisieren. Ein Flowchart-Diagramm wird bei Bedarf direkt gerendert.
    * **BF-Metrik-Auswahl:** Ein Dropdown-Menü erlaubt die Auswahl, welches Ergebnis der Brute-Force-Optimierung im Text zitiert werden soll, um die Narrative anzupassen.

### 3.6. Export Tab
* **Zweck:** Dient als zentraler Hub für den Export aller generierten Daten, Analyseergebnisse, Tabellen und Grafiken.
* **Komponenten & Workflow:**
    * **Export-Kategorien:** Die Optionen sind in "Single Exports" und "Export Packages (.zip)" unterteilt.
    * **Kontext-Sensitivität:** Alle Exporte basieren auf der aktuell gewählten globalen Kohorte und den angewandten T2-Kriterien. Nicht verfügbare Exporte sind deaktiviert.
    * **Verfügbare Exporte (Auszug):** Gefilterte Rohdaten (CSV), Analysetabellen (MD), Statistikberichte (CSV), Brute-Force-Berichte (TXT), ein umfassender HTML-Analysebericht sowie ZIP-Archive, die alle Grafiken (PNG/SVG) oder alle Markdown-Texte bündeln.

## 4. Technischer Anhang

### 4.1. Schlüsseltechnologien
Die Anwendung basiert auf modernen Web-Technologien, um eine interaktive und performante Analyse direkt im Browser zu ermöglichen:
* **Kern:** HTML5, CSS3, JavaScript (ES6+)
* **UI/Layout:** Bootstrap 5
* **Datenvisualisierung:** D3.js
* **Asynchrone Berechnung:** Web Workers (für die Brute-Force-Optimierung)
* **UI-Verbesserungen:** Tippy.js (für Tooltips)
* **Dateiverarbeitung:** PapaParse (CSV), JSZip (ZIP-Archive), html2canvas (Bildexport von HTML-Elementen).

### 4.2. Glossar
* **AS:** Avocado Sign
* **AUC:** Area Under the Curve. Ein Maß für die Gesamtleistung eines diagnostischen Tests.
* **BF:** Brute-Force. Eine erschöpfende Suchmethode zur Identifizierung optimaler Parameter.
* **CI:** Confidence Interval (Konfidenzintervall).
* **nRCT:** Neoadjuvant Chemoradiotherapy.
* **NPV:** Negative Predictive Value (Negativer prädiktiver Wert).
* **OR:** Odds Ratio (Chancenverhältnis).
* **PPV:** Positive Predictive Value (Positiver prädiktiver Wert).
* **RD:** Risk Difference (Risikodifferenz).
* **T2w:** T2-weighted (T2-gewichtet). Eine spezifische Art von MRT-Sequenz.
