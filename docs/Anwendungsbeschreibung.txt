# Anwendungsbeschreibung: Nodal Staging Analysis Tool (Version 3.1.0)

## 1. Einleitung

### 1.1. Zweck und Geltungsbereich
Das **Nodal Staging: Avocado Sign vs. T2 Criteria** Analysis Tool ist eine client-seitige Webanwendung, die für die wissenschaftliche Forschung in der radiologischen Diagnostik des Rektumkarzinoms entwickelt wurde. Sie bietet eine interaktive Plattform, um die diagnostische Güte verschiedener MRT-basierter Kriterien zur Beurteilung des mesorektalen Lymphknotenstatus (N-Status) tiefgreifend zu analysieren und zu vergleichen.

Der Fokus liegt auf der Evaluation des "Avocado Sign" (AS) im Vergleich zu etablierten, literaturbasierten sowie datengetriebenen, kohorten-optimierten T2-gewichteten (T2w) morphologischen Kriterien. Die Anwendung begleitet den gesamten Forschungsprozess von der Datenexploration über die statistische Analyse bis hin zur Erstellung von publikationsreifen Manuskriptentwürfen.

### 1.2. Kernfunktionalitäten
* **Interaktive Datenexploration:** Visualisierung und Sortierung des pseudonymisierten Patientendatensatzes mit detaillierter Ansicht einzelner Lymphknotenmerkmale.
* **Flexible Kriteriendefinition:** Dynamische Definition und Anwendung komplexer T2w-Malignitätskriterien inklusive logischer Verknüpfungen (AND/OR).
* **Automatisierte Kriterien-Optimierung:** Eine integrierte Brute-Force-Analyse identifiziert auf Basis einer wählbaren Zielmetrik die mathematisch optimalen T2w-Kriterienkombinationen für eine gegebene Patientenkohorte.
* **Umfassende statistische Analyse:** Berechnung und Darstellung aller relevanten Metriken zur diagnostischen Güte (Sensitivität, Spezifität, PPV, NPV, Genauigkeit, AUC) inklusive 95%-Konfidenzintervallen und statistischer Vergleichstests (z.B. DeLong, McNemar).
* **Publikations-Assistent:** Generierung von formatierten Texten, Tabellen und Abbildungen für ein wissenschaftliches Manuskript unter Einhaltung der Stilrichtlinien des Fachjournals *Radiology*.
* **Vielseitiger Datenexport:** Export von Rohdaten, Analyseergebnissen, Tabellen, Grafiken und Publikationstexten in verschiedenen Formaten (CSV, MD, TXT, PNG, SVG, HTML).

### 1.3. Wichtiger Hinweis: Forschungsinstrument
**Disclaimer:** Diese Anwendung ist ausschließlich für **Forschungs- und Bildungszwecke** konzipiert. Die dargestellten Daten, Statistiken und Texte basieren auf einem statischen, pseudonymisierten Forschungsdatensatz. **Die Ergebnisse dürfen nicht für die klinische Diagnostik, direkte Behandlungsentscheidungen oder andere primäre medizinische Anwendungen herangezogen werden.** Die wissenschaftliche und klinische Verantwortung für die Interpretation und Verwendung der generierten Ergebnisse liegt allein beim Nutzer.

## 2. Systemanforderungen & Einrichtung

Die Anwendung ist eine in sich geschlossene Web-Applikation und erfordert keine serverseitige Komponente oder Installation.
* **Voraussetzungen:** Ein moderner Desktop-Webbrowser (z.B. aktuelle Versionen von Google Chrome, Mozilla Firefox, Microsoft Edge oder Safari).
* **Ausführung:** Öffnen Sie die Datei `index.html` in einem kompatiblen Browser. Eine Internetverbindung wird für das Laden externer Bibliotheken (z.B. Bootstrap, D3.js) von CDNs benötigt.

## 3. Globale UI-Konzepte & Bedienung

Die Benutzeroberfläche ist auf einen intuitiven und effizienten wissenschaftlichen Arbeitsablauf ausgelegt.

### 3.1. Anwendungs-Layout
* **Header:** Ein feststehender Kopfbereich enthält den Titel, die globale Kohortenauswahl sowie dynamische Meta-Statistiken.
* **Navigationsleiste (Tabs):** Eine Reiter-Navigation ermöglicht den Wechsel zwischen den sechs Hauptmodulen der Anwendung.
* **Inhaltsbereich:** Der Hauptarbeitsbereich, in dem die Inhalte des jeweils aktiven Tabs dargestellt werden.

### 3.2. Globale Kohortenauswahl
Ein zentrales Bedienkonzept der Anwendung. Drei Buttons im Header filtern den gesamten Datensatz für alle Analysen:
* **Overall:** Schließt alle 106 Patienten ein.
* **Surgery alone:** Filtert auf Patienten, die primär operiert wurden.
* **Neoadjuvant therapy:** Filtert auf Patienten, die eine neoadjuvante Radiochemotherapie erhalten haben.

Diese Auswahl ist **global** und wirkt sich unmittelbar auf alle angezeigten Daten, Tabellen, Grafiken und statistischen Berechnungen in allen Tabs aus.

### 3.3. Dynamische Header-Statistiken
Ein Bereich im Header zeigt eine Live-Zusammenfassung der aktiven Kohorte:
* **Cohort:** Name der aktiven Kohorte.
* **Patients:** Gesamtzahl der Patienten in der Kohorte.
* **N-Status, AS-Status, T2-Status:** Prozentualer Anteil der positiven Patienten für den pathologischen N-Status, das Avocado Sign und die aktuell angewandten T2-Kriterien.

### 3.4. Interaktive Hilfe
* **Tooltips:** Fast alle UI-Elemente sind mit detaillierten Tooltips versehen, die bei Mouse-Over deren Funktion oder die Definition einer Metrik erklären.
* **Quick Guide:** Ein `?`-Button im Header öffnet eine umfassende Anleitung, die alle Funktionen und Konzepte der Anwendung erläutert.

## 4. Die Anwendungsmodule im Detail (Tabs)

### 4.1. Data Tab
* **Zweck:** Darstellung und Exploration der zugrundeliegenden Patientendaten.
* **Komponenten & Workflow:**
    * **Patiententabelle:** Eine sortierbare Tabelle listet alle Patienten der gewählten Kohorte auf. Durch Klick auf die Spaltenköpfe kann sortiert werden. Der "N/AS/T2"-Header erlaubt ein Sub-Sorting durch Klick auf die Labels "N", "AS" oder "T2".
    * **Detailansicht:** Zeilen von Patienten mit vorhandenen T2-Lymphknotendaten sind durch Klick erweiterbar. Die Detailansicht zeigt eine Liste der individuellen T2-Lymphknoten mit ihren morphologischen Eigenschaften (Größe, Form etc.).
    * **"Expand/Collapse All"-Button:** Schaltet die Detailansicht für alle Patienten in der Tabelle gleichzeitig ein oder aus.

### 4.2. Analysis Tab
* **Zweck:** Interaktive Definition von T2-Kriterien, Durchführung von Optimierungsanalysen und Untersuchung der Auswirkungen auf Patientenebene.
* **Komponenten & Workflow:**
    1.  **Dashboard:** Grafische Übersicht über die Verteilung von Alter, Geschlecht, Therapie und Status (N, AS, T2) in der aktuellen Kohorte.
    2.  **Define T2 Malignancy Criteria:** Das interaktive Herzstück des Tabs.
        * **Aktivierung & Konfiguration:** Jedes T2-Merkmal (Size, Shape etc.) kann per Checkbox aktiviert/deaktiviert werden. Die Schwellenwerte (für Größe) oder Kategorien (für Form, etc.) werden interaktiv per Slider oder Button-Klick eingestellt.
        * **Logik-Schalter:** Ein Schalter wechselt die logische Verknüpfung zwischen **AND** (alle aktiven Kriterien müssen für ein positives Ergebnis erfüllt sein) und **OR** (ein Kriterium genügt).
        * **Indikator für ungespeicherte Änderungen:** Der Kartenrand wird markiert, wenn Änderungen vorgenommen, aber noch nicht angewendet wurden.
        * **Apply & Save:** Übernimmt die konfigurierten Kriterien in die gesamte Anwendung, aktualisiert alle T2-Status-Angaben und Statistiken und speichert die Einstellung für zukünftige Sitzungen.
    3.  **Diagnostic Performance (Applied T2):** Eine Tabelle, die sich automatisch nach dem Anwenden neuer Kriterien aktualisiert und die vollständige diagnostische Güte der aktuellen T2-Einstellung anzeigt.
    4.  **Criteria Optimization (Brute-Force):** Ein Werkzeug zur automatisierten Suche nach den besten T2-Kriterien.
        * **Workflow:** Der Nutzer wählt eine Zielmetrik (z.B. "Balanced Accuracy") und startet die Analyse. Ein Web Worker testet im Hintergrund tausende Kombinationen, ohne die Benutzeroberfläche zu blockieren.
        * **Live-Feedback:** Ein Fortschrittsbalken und das bisher beste Ergebnis werden live angezeigt.
        * **Ergebnisse:** Nach Abschluss werden die optimalen Kriterien angezeigt und können per Klick auf "Apply Best Criteria" direkt in die Definitions-Maske übernommen werden. Ein "Top 10"-Button öffnet eine detaillierte Rangliste.
    5.  **Analyse-Tabelle:** Zeigt für jeden Patienten den N/AS/T2-Status. Erweiterbare Zeilen visualisieren hier, wie jeder einzelne T2-Lymphknoten gegen die *aktuell angewandten* Kriterien evaluiert wurde. Erfüllte Kriterien, die zu einer positiven Einstufung führen, werden farblich hervorgehoben.

### 4.3. Statistics Tab
* **Zweck:** Umfassende und formale statistische Auswertung.
* **Komponenten & Workflow:**
    * **Ansicht-Umschalter:** Wechselt zwischen **"Single View"** (detaillierte Analyse der global gewählten Kohorte) und **"Comparison Active"** (direkter statistischer Vergleich zweier wählbarer Kohorten).
    * **Statistik-Karten:** Eine Serie von Karten zeigt: Deskriptive Statistiken, diagnostische Güte für AS und T2 (jeweils separat), den direkten statistischen Vergleich zwischen AS und T2 (McNemar, DeLong) und Assoziationsanalysen einzelner Merkmale mit dem N-Status.

### 4.4. Presentation Tab
* **Zweck:** Erstellung von Grafiken und Tabellen für wissenschaftliche Präsentationen.
* **Komponenten & Workflow:**
    * **Ansicht-Auswahl:** Radio-Buttons wechseln die Ansicht zwischen **"AS Performance"** (Fokus auf die Güte des Avocado Signs) und **"AS vs. T2 Comparison"** (direkter Vergleich).
    * **T2-Vergleichsbasis:** Im Vergleichsmodus kann aus einem Dropdown-Menü gewählt werden, womit AS verglichen werden soll: mit den selbst definierten ("Applied") Kriterien oder einem der vordefinierten Literatur-Kriteriensets.
    * **Dynamische Inhalte:** Die Ansicht generiert dynamisch Vergleichstabellen, statistische Tests und Balkendiagramme. Alle Elemente können als CSV, MD, PNG oder SVG exportiert werden.

### 4.5. Publication Tab
* **Zweck:** Unterstützung bei der Erstellung eines wissenschaftlichen Manuskripts nach den Stilrichtlinien des Journals *Radiology*.
* **Komponenten & Workflow:**
    * **Sektions-Navigation:** Eine Seitenleiste ermöglicht die Navigation durch die Standardabschnitte eines Papers (Abstract, Introduction, Methods, Results, Discussion, References).
    * **Dynamische Textgenerierung:** Die Anwendung generiert professionell formulierte, englischsprachige Texte für jeden Abschnitt. Diese Texte integrieren dynamisch die **aktuellsten Analyseergebnisse** und formatieren diese korrekt nach den journalistischen Vorgaben (z.B. *P* < .001, 95% CI).
    * **Eingebettete Inhalte:** Tabellen und Abbildungs-Platzhalter werden direkt im Textfluss generiert, um die Manuskriptstruktur zu visualisieren.
    * **BF-Metrik-Auswahl:** Ein Dropdown-Menü erlaubt die Auswahl, welches Brute-Force-Ergebnis im Text zitiert werden soll, um die Narrative an das Optimierungsziel anzupassen.

### 4.6. Export Tab
* **Zweck:** Zentraler Hub für den Export aller Daten und Ergebnisse.
* **Komponenten & Workflow:**
    * **Export-Kategorien:** Optionen sind unterteilt in "Single Exports" und "Export Packages (.zip)".
    * **Kontext-Sensitivität:** Alle Exporte basieren auf der aktuell gewählten globalen Kohorte und den angewandten T2-Kriterien. Nicht verfügbare Exporte (z.B. Brute-Force-Report vor einer Analyse) sind deaktiviert.
    * **Verfügbare Exporte:** Gefilterte Rohdaten (CSV), Analysetabellen (MD), Statistikberichte (CSV), Brute-Force-Berichte (TXT), ein umfassender HTML-Analysebericht sowie ZIP-Archive mit allen Grafiken (PNG/SVG) oder Markdown-Texten.

## 5. Technischer Anhang

### 5.1. Schlüsseltechnologien
* **Kern:** HTML5, CSS3, JavaScript (ES6+)
* **UI/Layout:** Bootstrap 5
* **Visualisierung:** D3.js
* **Helfer-Bibliotheken:** Tippy.js (Tooltips), PapaParse (CSV), JSZip (ZIP-Archive), html2canvas (Bild-Rendering)
* **Asynchrone Berechnung:** Web Workers

### 5.2. Konfiguration (`config.js`)
Die Datei `js/config.js` ist die zentrale Konfigurationsstelle der Anwendung. Sie enthält alle Standardeinstellungen, UI-Texte, statistische Konstanten, Export-Konfigurationen und vordefinierte Literatur-Kriteriensets.

### 5.3. Glossar
* **AS:** Avocado Sign
* **AUC:** Area Under the Curve (Fläche unter der ROC-Kurve)
* **BF:** Brute-Force (Optimierungsmethode)
* **CI:** Confidence Interval (Konfidenzintervall)
* **nRCT:** Neoadjuvant Chemoradiotherapy (Neoadjuvante Radiochemotherapie)
* **NPV:** Negative Predictive Value (Negativer prädiktiver Wert)
* **OR:** Odds Ratio
* **PPV:** Positive Predictive Value (Positiver prädiktiver Wert)
* **RD:** Risk Difference (Risikodifferenz)
* **T2w:** T2-weighted (T2-gewichtet)
